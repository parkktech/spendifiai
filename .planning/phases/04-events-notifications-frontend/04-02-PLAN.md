---
phase: 04-events-notifications-frontend
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - resources/css/app.css
  - resources/js/types/spendwise.d.ts
  - resources/js/types/index.d.ts
  - resources/js/hooks/useApi.ts
  - resources/js/Layouts/AuthenticatedLayout.tsx
  - resources/js/Pages/Dashboard.tsx
  - resources/js/Pages/Transactions/Index.tsx
  - resources/js/Pages/Connect/Index.tsx
  - resources/js/Pages/Settings/Index.tsx
  - resources/js/Pages/Questions/Index.tsx
  - resources/js/Components/SpendWise/StatCard.tsx
  - resources/js/Components/SpendWise/SpendingChart.tsx
  - resources/js/Components/SpendWise/TransactionRow.tsx
  - resources/js/Components/SpendWise/PlaidLinkButton.tsx
  - resources/js/Components/SpendWise/QuestionCard.tsx
  - resources/js/Components/SpendWise/FilterBar.tsx
  - resources/js/Components/SpendWise/ConfirmDialog.tsx
  - resources/js/Components/SpendWise/Badge.tsx
  - routes/web.php
  - package.json
autonomous: true

must_haves:
  truths:
    - "Dashboard page loads and shows spending summary cards, category breakdown chart, recent transactions, and AI question alert banner"
    - "Transactions page loads with filter bar (date, category, business/personal), transaction table with inline category edit, and pagination"
    - "Connect page shows Plaid Link button that opens bank connection modal, lists connected accounts with status, and has disconnect buttons"
    - "Settings page shows financial profile form, password change, 2FA toggle, and delete account with confirmation"
    - "AI Questions page shows pending questions with transaction context, supports multiple-choice and free-text answers, and bulk answer mode"
    - "All pages use dark theme matching reference dashboard color palette"
    - "Sidebar navigation works on all pages with active state indicators"
  artifacts:
    - path: "resources/js/Layouts/AuthenticatedLayout.tsx"
      provides: "Sidebar navigation layout with dark theme"
      contains: "sidebar"
    - path: "resources/js/Pages/Dashboard.tsx"
      provides: "Main dashboard with spending summary and charts"
      contains: "useApi"
    - path: "resources/js/Pages/Transactions/Index.tsx"
      provides: "Transaction list with filters"
      contains: "FilterBar"
    - path: "resources/js/Pages/Connect/Index.tsx"
      provides: "Bank connection page with Plaid Link"
      contains: "PlaidLinkButton"
    - path: "resources/js/Pages/Settings/Index.tsx"
      provides: "Settings page with financial profile and security"
      contains: "delete"
    - path: "resources/js/Pages/Questions/Index.tsx"
      provides: "AI questions page with answer forms"
      contains: "QuestionCard"
    - path: "resources/js/hooks/useApi.ts"
      provides: "Reusable API fetch hook"
      contains: "useApi"
    - path: "resources/js/types/spendwise.d.ts"
      provides: "TypeScript types for all API responses"
      contains: "Transaction"
    - path: "resources/css/app.css"
      provides: "Dark theme CSS with SpendWise color palette"
      contains: "@theme"
  key_links:
    - from: "resources/js/Pages/Dashboard.tsx"
      to: "/api/v1/dashboard"
      via: "useApi hook fetching dashboard data"
      pattern: "api/v1/dashboard"
    - from: "resources/js/Pages/Transactions/Index.tsx"
      to: "/api/v1/transactions"
      via: "useApi hook fetching transaction list"
      pattern: "api/v1/transactions"
    - from: "resources/js/Components/SpendWise/PlaidLinkButton.tsx"
      to: "/api/v1/plaid/link-token"
      via: "axios POST to create link token"
      pattern: "api/v1/plaid"
    - from: "routes/web.php"
      to: "resources/js/Pages/**"
      via: "Inertia::render() resolving page components"
      pattern: "Inertia::render"
---

<objective>
Install frontend dependencies (recharts, lucide-react, react-plaid-link), set up dark theme and TypeScript types, redesign AuthenticatedLayout with sidebar navigation, create the useApi hook, and build 5 frontend pages: Dashboard, Transactions, Connect, Settings, AI Questions.

Purpose: Transform the Breeze scaffold into the SpendWise application with a dark-themed sidebar layout and the first batch of functional pages that fetch real data from the existing API endpoints.

Output: 3 npm packages installed, dark theme CSS, TypeScript types, useApi hook, sidebar layout, 5 pages, 8 shared components, updated web routes.
</objective>

<execution_context>
@/home/jratz/.claude/get-shit-done/workflows/execute-plan.md
@/home/jratz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-events-notifications-frontend/04-RESEARCH.md
@existing-code/reference-dashboard.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install deps, dark theme, TypeScript types, useApi hook, sidebar layout, web routes</name>
  <files>
    package.json
    resources/css/app.css
    resources/js/types/spendwise.d.ts
    resources/js/types/index.d.ts
    resources/js/hooks/useApi.ts
    resources/js/Layouts/AuthenticatedLayout.tsx
    routes/web.php
    resources/js/Components/SpendWise/StatCard.tsx
    resources/js/Components/SpendWise/Badge.tsx
    resources/js/Components/SpendWise/ConfirmDialog.tsx
  </files>
  <action>
    **Step 1: Install npm packages**
    ```bash
    cd /var/www/html/ledgeriq && npm install recharts lucide-react react-plaid-link
    ```

    **Step 2: Set up dark theme in app.css**

    Replace the contents of `resources/css/app.css` with Tailwind 4 CSS-based config:
    ```css
    @import "tailwindcss";

    @theme {
      --color-sw-bg: #0B0F1A;
      --color-sw-sidebar: #0F1629;
      --color-sw-card: #111827;
      --color-sw-card-hover: #1a2332;
      --color-sw-border: #1e293b;
      --color-sw-accent: #10b981;
      --color-sw-accent-hover: #059669;
      --color-sw-danger: #ef4444;
      --color-sw-warning: #f59e0b;
      --color-sw-text: #f1f5f9;
      --color-sw-muted: #94a3b8;
      --color-sw-dim: #64748b;
      --font-sans: 'Figtree', ui-sans-serif, system-ui, sans-serif;
    }

    body {
      @apply bg-sw-bg text-sw-text;
    }
    ```

    NOTE: Tailwind 4 uses `@import "tailwindcss"` not `@tailwind base/components/utilities`. The `@theme` directive defines custom design tokens that become Tailwind utilities (e.g., `bg-sw-bg`, `text-sw-accent`).

    **Step 3: Create TypeScript types**

    Create `resources/js/types/spendwise.d.ts` with all API response types. Reference the existing API Resources and controllers for exact shapes:

    ```typescript
    export interface Transaction {
      id: number;
      merchant_name: string;
      amount: number;
      date: string;
      description: string | null;
      ai_category: string | null;
      user_category: string | null;
      ai_confidence: number | null;
      review_status: string;
      expense_type: string;
      account_purpose: string;
      tax_deductible: boolean;
      is_subscription: boolean;
      category: string;
      account?: BankAccount;
    }

    export interface BankAccount {
      id: number;
      name: string;
      official_name: string | null;
      type: string;
      subtype: string | null;
      mask: string | null;
      current_balance: number | null;
      available_balance: number | null;
      purpose: string;
      institution_name: string | null;
    }

    export interface BankConnection {
      id: number;
      institution_name: string;
      status: string;
      last_synced_at: string | null;
      error_code: string | null;
      error_message: string | null;
      accounts: BankAccount[];
    }

    export interface Subscription {
      id: number;
      merchant_name: string;
      amount: number;
      frequency: string;
      status: string;
      category: string | null;
      last_charge_date: string | null;
      next_expected_date: string | null;
      annual_cost: number;
      is_active: boolean;
    }

    export interface AIQuestion {
      id: number;
      transaction_id: number;
      question_text: string;
      question_type: string;
      status: string;
      options: string[] | null;
      user_answer: string | null;
      created_at: string;
      transaction?: Transaction;
    }

    export interface SavingsRecommendation {
      id: number;
      title: string;
      description: string;
      potential_savings: number;
      priority: string;
      category: string;
      status: string;
      action_steps: string[] | null;
      related_merchants: string[] | null;
    }

    export interface SavingsTarget {
      id: number;
      name: string;
      target_amount: number;
      current_amount: number;
      deadline: string | null;
      monthly_target: number;
      status: string;
      actions?: SavingsPlanAction[];
    }

    export interface SavingsPlanAction {
      id: number;
      title: string;
      description: string;
      estimated_savings: number;
      status: string;
      frequency: string | null;
    }

    export interface ExpenseCategory {
      id: number;
      name: string;
      slug: string;
      irs_category: string | null;
      tax_line: string | null;
    }

    export interface DashboardData {
      view_mode: 'all' | 'personal' | 'business';
      summary: {
        this_month_spending: number;
        month_over_month: number;
        potential_savings: number;
        tax_deductible_ytd: number;
        needs_review: number;
        unused_subscriptions: number;
        pending_questions: number;
      };
      categories: Array<{ category: string; total: number; count: number }>;
      questions: AIQuestion[];
      recent: Transaction[];
      spending_trend: Array<{ month: string; total: number }>;
      sync_status: { status: string; last_synced_at: string; institution_name: string } | null;
      accounts_summary: { personal: number; business: number; mixed: number };
    }

    export interface TaxSummary {
      year: number;
      total_business_expenses: number;
      total_personal_expenses: number;
      total_tax_deductible: number;
      deductions_by_category: Array<{
        category: string;
        tax_line: string;
        total: number;
        count: number;
      }>;
    }

    export interface UserFinancialProfile {
      employment_type: string | null;
      filing_status: string | null;
      monthly_income: number | null;
      business_type: string | null;
      tax_year_start: string | null;
    }

    export interface PaginatedResponse<T> {
      data: T[];
      meta: {
        current_page: number;
        last_page: number;
        per_page: number;
        total: number;
      };
      links: {
        first: string;
        last: string;
        prev: string | null;
        next: string | null;
      };
    }
    ```

    Update `resources/js/types/index.d.ts` to extend the User interface and re-export spendwise types:
    ```typescript
    export interface User {
      id: number;
      name: string;
      email: string;
      email_verified_at?: string;
      two_factor_enabled?: boolean;
      google_connected?: boolean;
    }

    export type PageProps<T extends Record<string, unknown> = Record<string, unknown>> = T & {
      auth: {
        user: User;
      };
    };
    ```

    **Step 4: Create useApi hook**

    Create `resources/js/hooks/useApi.ts`:
    - Generic hook `useApi<T>(url: string, options?: { immediate?: boolean })` that returns `{ data, loading, error, refresh, mutate }`
    - Uses axios GET on mount (if immediate !== false)
    - `refresh()` re-fetches data
    - `mutate(newData)` sets data optimistically
    - Also create `useApiPost<T, D>(url: string)` that returns `{ submit, loading, error, data }` for POST/PUT/DELETE operations

    **Step 5: Create small shared components**

    Create `resources/js/Components/SpendWise/StatCard.tsx`:
    - Props: `{ title: string; value: string | number; subtitle?: string; trend?: number; icon?: ReactNode }`
    - Dark-themed card (bg-sw-card, border-sw-border) with icon, title, value, optional trend arrow (green up / red down)

    Create `resources/js/Components/SpendWise/Badge.tsx`:
    - Props: `{ children: ReactNode; variant: 'success' | 'warning' | 'danger' | 'info' | 'neutral' }`
    - Color-coded pill badge using Tailwind classes

    Create `resources/js/Components/SpendWise/ConfirmDialog.tsx`:
    - Props: `{ open: boolean; onConfirm: () => void; onCancel: () => void; title: string; message: string; confirmText?: string; variant?: 'danger' | 'default' }`
    - Uses @headlessui/react Dialog for accessibility
    - Dark-themed modal with backdrop

    **Step 6: Redesign AuthenticatedLayout with sidebar**

    Rewrite `resources/js/Layouts/AuthenticatedLayout.tsx`:
    - Left sidebar (w-64, bg-sw-sidebar) with:
      - App logo/name at top ("SpendWise" or "LedgerIQ")
      - Navigation items using Inertia `<Link>`: Dashboard, Transactions, Subscriptions, Savings, Tax, Connect, Settings, AI Questions
      - Each nav item has a Lucide icon (LayoutDashboard, Receipt, CreditCard, PiggyBank, FileText, Link2, Settings, HelpCircle)
      - Active state: bg-sw-accent/10 text-sw-accent border-l-2 border-sw-accent
      - Inactive state: text-sw-muted hover:text-sw-text hover:bg-sw-card
    - Top bar (h-16) with:
      - Page title from `header` prop
      - Right side: notification bell icon (with count badge if > 0), user dropdown (name, Profile link, Log Out)
    - Main content area (flex-1, overflow-y-auto, p-6)
    - Mobile responsive: sidebar collapses to hamburger menu on small screens
    - Import route() from ziggy for active state detection
    - The entire layout uses dark theme colors (bg-sw-bg for main area)

    **Step 7: Add Inertia web routes**

    Update `routes/web.php` to add all SpendWise page routes inside the existing auth middleware group:
    ```php
    Route::middleware(['auth', 'verified'])->group(function () {
        Route::get('/dashboard', fn() => Inertia::render('Dashboard'))->name('dashboard');
        Route::get('/transactions', fn() => Inertia::render('Transactions/Index'))->name('transactions');
        Route::get('/subscriptions', fn() => Inertia::render('Subscriptions/Index'))->name('subscriptions');
        Route::get('/savings', fn() => Inertia::render('Savings/Index'))->name('savings');
        Route::get('/tax', fn() => Inertia::render('Tax/Index'))->name('tax');
        Route::get('/connect', fn() => Inertia::render('Connect/Index'))->name('connect');
        Route::get('/settings', fn() => Inertia::render('Settings/Index'))->name('settings');
        Route::get('/questions', fn() => Inertia::render('Questions/Index'))->name('questions');
    });
    ```
    Replace the existing standalone `/dashboard` route with this group. Keep all other routes (profile, google callback, health, auth) unchanged.
  </action>
  <verify>
    Run `npm run build` to verify TypeScript compilation and Tailwind CSS processing succeed.
    Run `php artisan route:list --path=/` to verify all 8 Inertia routes are registered.
    Verify packages installed: `ls node_modules/recharts node_modules/lucide-react node_modules/react-plaid-link`
  </verify>
  <done>
    3 npm packages installed. Dark theme CSS with @theme directive in app.css. Full TypeScript types in spendwise.d.ts. useApi hook created. AuthenticatedLayout redesigned with sidebar navigation and dark theme. 8 Inertia routes registered in web.php. StatCard, Badge, ConfirmDialog shared components created.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build Dashboard, Transactions, Connect, Settings, and AI Questions pages</name>
  <files>
    resources/js/Pages/Dashboard.tsx
    resources/js/Pages/Transactions/Index.tsx
    resources/js/Pages/Connect/Index.tsx
    resources/js/Pages/Settings/Index.tsx
    resources/js/Pages/Questions/Index.tsx
    resources/js/Components/SpendWise/SpendingChart.tsx
    resources/js/Components/SpendWise/TransactionRow.tsx
    resources/js/Components/SpendWise/PlaidLinkButton.tsx
    resources/js/Components/SpendWise/QuestionCard.tsx
    resources/js/Components/SpendWise/FilterBar.tsx
  </files>
  <action>
    Build 5 shared components and 5 pages. All pages use AuthenticatedLayout, useApi hook, dark theme. Reference `existing-code/reference-dashboard.jsx` for visual design patterns.

    **Shared Components:**

    1. **SpendingChart** (`resources/js/Components/SpendWise/SpendingChart.tsx`):
       - Props: `{ data: Array<{ month: string; total: number }>; categories?: Array<{ category: string; total: number }> }`
       - Two chart modes: area chart for spending trend (using Recharts AreaChart), pie/donut chart for category breakdown (using Recharts PieChart)
       - Dark theme colors: stroke sw-accent, fill sw-accent with opacity, grid lines sw-border
       - Responsive container using Recharts ResponsiveContainer

    2. **TransactionRow** (`resources/js/Components/SpendWise/TransactionRow.tsx`):
       - Props: `{ transaction: Transaction; onCategoryChange?: (id: number, category: string) => void }`
       - Row with: merchant name, date, amount (red for debit, green for credit), category badge, review status indicator
       - Inline category edit: clicking category shows dropdown with category options, calls onCategoryChange
       - Business/personal indicator (Badge component)
       - Tax deductible flag icon

    3. **PlaidLinkButton** (`resources/js/Components/SpendWise/PlaidLinkButton.tsx`):
       - Props: `{ onSuccess: () => void; onError?: (msg: string) => void; className?: string }`
       - On mount, POST to `/api/v1/plaid/link-token` to get link_token
       - Uses `usePlaidLink` from react-plaid-link with the token
       - On success callback, POST to `/api/v1/plaid/exchange` with public_token, then call `onSuccess`
       - Styled as primary button with sw-accent background, bank icon (Lucide Building2)
       - Loading state while fetching link token, disabled while not ready

    4. **QuestionCard** (`resources/js/Components/SpendWise/QuestionCard.tsx`):
       - Props: `{ question: AIQuestion; onAnswer: (id: number, answer: string) => void }`
       - Shows transaction context (merchant, amount, date) from question.transaction
       - Shows question_text prominently
       - If question_type is 'multiple_choice': render option buttons from question.options
       - If question_type is 'open_ended': render text input with submit button
       - Loading state after submission
       - Dark card style (bg-sw-card, border-sw-border)

    5. **FilterBar** (`resources/js/Components/SpendWise/FilterBar.tsx`):
       - Props: `{ filters: FilterState; onChange: (filters: FilterState) => void; categories?: string[] }`
       - FilterState type: `{ date_from?: string; date_to?: string; category?: string; account_purpose?: string; search?: string }`
       - Date range picker (two date inputs), category dropdown, business/personal toggle (all/personal/business), search input
       - All inputs dark-themed (bg-sw-card, border-sw-border, text-sw-text)
       - Calls onChange on any filter change (debounced for search input)

    **Pages:**

    1. **Dashboard** (`resources/js/Pages/Dashboard.tsx`):
       - Replace the existing placeholder completely
       - Uses `useApi<DashboardData>('/api/v1/dashboard')` to fetch data on mount
       - Layout: 4 StatCards in a grid row (This Month Spending, Month-over-Month %, Potential Savings, Tax Deductible YTD)
       - Below: two columns — left has SpendingChart (area chart for spending trend), right has category breakdown (pie chart)
       - Below charts: AI Question alert banner if `summary.pending_questions > 0` — links to /questions
       - Below alert: Recent Transactions list using TransactionRow (last 10)
       - Sync status indicator in top area (last synced time, connection name)
       - Loading skeleton while data fetches

    2. **Transactions** (`resources/js/Pages/Transactions/Index.tsx`):
       - Uses `useApi<PaginatedResponse<Transaction>>` with dynamic URL from filter state
       - FilterBar at top with all filter options
       - TransactionRow for each transaction in a table/list layout
       - Pagination controls at bottom (prev/next, page numbers)
       - Inline category edit on each TransactionRow — POST to `/api/v1/transactions/{id}/category` on change
       - Summary stats at top (total transactions, total amount, business vs personal breakdown)
       - Empty state message if no transactions

    3. **Connect** (`resources/js/Pages/Connect/Index.tsx`):
       - Section 1: "Connect Your Bank" with PlaidLinkButton component
       - Section 2: Connected Accounts list — fetches from `/api/v1/accounts`
         - Each account card shows: institution name, account name, type, last 4 digits (mask), balance, purpose badge
         - Purpose dropdown (personal/business/mixed) — PUT to `/api/v1/accounts/{id}/purpose`
         - Disconnect button — DELETE to `/api/v1/plaid/disconnect` (with ConfirmDialog)
         - Status badge (active/error/reauth_required)
       - Section 3: Email Connection — POST to `/api/v1/email/connect` button, status display
       - Refresh button to trigger manual sync — POST to `/api/v1/plaid/sync`

    4. **Settings** (`resources/js/Pages/Settings/Index.tsx`):
       - Section 1: Financial Profile form
         - Fetches from `/api/v1/profile/financial`
         - Fields: employment_type (dropdown: employed/self_employed/freelancer/retired/student/other), filing_status (dropdown), monthly_income (number input), business_type (text), tax_year_start (date)
         - Save button — PUT to `/api/v1/profile/financial`
       - Section 2: Security
         - Change password form (current_password, password, password_confirmation) — POST to `/api/v1/auth/change-password`
         - 2FA toggle — shows status, enable/disable buttons calling `/api/v1/auth/2fa/enable` and `/api/v1/auth/2fa/disable`
         - Google account link status
       - Section 3: Delete Account
         - Red "Delete Account" button that opens ConfirmDialog
         - Requires password confirmation in dialog
         - DELETE to `/api/v1/profile/delete`
       - All sections in dark cards (bg-sw-card)

    5. **AI Questions** (`resources/js/Pages/Questions/Index.tsx`):
       - Fetches from `/api/v1/questions?status=pending`
       - Header with count: "{N} questions need your attention"
       - Toggle between single mode and bulk mode
       - Single mode: QuestionCard for each question, scrollable list
       - Bulk mode: All questions shown in a compact table, with answer inputs inline, "Submit All" button that POST to `/api/v1/questions/bulk-answer`
       - After answering: remove from list, show success toast/message
       - Empty state: "All caught up! No questions pending." with checkmark icon
       - Each QuestionCard calls POST `/api/v1/questions/{id}/answer` with `{ answer: string }`

    **Important patterns for ALL pages:**
    - Use `Head` from `@inertiajs/react` to set page title
    - Wrap content in `<AuthenticatedLayout>` with appropriate header
    - Handle loading state (show skeleton/spinner)
    - Handle error state (show error message with retry button)
    - Handle empty state (informative message with action suggestion)
    - All monetary amounts formatted with `$` and 2 decimal places
    - Dates formatted as "MMM D, YYYY" using Intl.DateTimeFormat
    - Use Lucide icons consistently
  </action>
  <verify>
    Run `npm run build` to verify all TypeScript compiles without errors.
    Run `php artisan route:list --path=/` to verify Inertia routes resolve.
    Verify file exists: `ls resources/js/Pages/Dashboard.tsx resources/js/Pages/Transactions/Index.tsx resources/js/Pages/Connect/Index.tsx resources/js/Pages/Settings/Index.tsx resources/js/Pages/Questions/Index.tsx`
    Verify shared components exist: `ls resources/js/Components/SpendWise/`
  </verify>
  <done>
    Dashboard shows spending summary, charts, recent transactions, and question alerts. Transactions page has filter bar, transaction list, inline category edit, pagination. Connect page has PlaidLinkButton, account list with purpose editing, disconnect. Settings page has financial profile form, security section, delete account. AI Questions page shows pending questions with answer forms and bulk mode. All pages use dark theme, AuthenticatedLayout sidebar, and fetch real API data via useApi hook.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with no TypeScript errors
2. `php artisan route:list --path=/` shows all 8 Inertia routes (dashboard, transactions, subscriptions, savings, tax, connect, settings, questions)
3. All 5 pages load without console errors (check Inertia page resolution)
4. Dashboard fetches from `/api/v1/dashboard` and renders data
5. Sidebar navigation shows active state on current page
6. Dark theme applied consistently across all pages
7. PlaidLinkButton component uses react-plaid-link SDK correctly
</verification>

<success_criteria>
- 3 npm packages installed (recharts, lucide-react, react-plaid-link)
- Dark theme with @theme CSS directive applied site-wide
- AuthenticatedLayout has sidebar navigation with 8 nav items and dark theme
- 8 Inertia routes registered in web.php
- Dashboard, Transactions, Connect, Settings, AI Questions pages all render
- All pages fetch real data from API via useApi hook
- TypeScript types cover all API response shapes
- `npm run build` succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/04-events-notifications-frontend/04-02-SUMMARY.md`
</output>
