---
phase: 04-events-notifications-frontend
plan: 03
type: execute
wave: 2
depends_on: ["04-02"]
files_modified:
  - resources/js/Pages/Subscriptions/Index.tsx
  - resources/js/Pages/Savings/Index.tsx
  - resources/js/Pages/Tax/Index.tsx
  - resources/js/Components/SpendWise/SubscriptionCard.tsx
  - resources/js/Components/SpendWise/RecommendationCard.tsx
  - resources/js/Components/SpendWise/ExportModal.tsx
  - resources/js/Components/SpendWise/ViewModeToggle.tsx
autonomous: true

must_haves:
  truths:
    - "Subscriptions page shows subscription cards in a grid with status badges, unused warnings, and monthly/annual cost totals"
    - "Savings page shows target progress gauge, recommendation cards with dismiss/apply, set target form, and pulse check"
    - "Tax page shows year selector, deduction summary by Schedule C line, export modal for Excel/PDF/CSV, and send-to-accountant modal"
    - "SubscriptionCard shows merchant name, amount, frequency, status, and annual cost"
    - "RecommendationCard shows title, potential savings, priority, action steps, and dismiss/apply buttons"
    - "ExportModal allows selecting export format and triggers download or email send"
    - "ViewModeToggle switches between all/personal/business view modes across pages that support it"
  artifacts:
    - path: "resources/js/Pages/Subscriptions/Index.tsx"
      provides: "Subscription list page with card grid"
      contains: "SubscriptionCard"
    - path: "resources/js/Pages/Savings/Index.tsx"
      provides: "Savings page with targets and recommendations"
      contains: "RecommendationCard"
    - path: "resources/js/Pages/Tax/Index.tsx"
      provides: "Tax summary and export page"
      contains: "ExportModal"
    - path: "resources/js/Components/SpendWise/SubscriptionCard.tsx"
      provides: "Individual subscription display card"
      contains: "annual_cost"
    - path: "resources/js/Components/SpendWise/RecommendationCard.tsx"
      provides: "Savings recommendation card with actions"
      contains: "dismiss"
    - path: "resources/js/Components/SpendWise/ExportModal.tsx"
      provides: "Tax export modal with format selection"
      contains: "download"
    - path: "resources/js/Components/SpendWise/ViewModeToggle.tsx"
      provides: "All/Personal/Business toggle component"
      contains: "viewMode"
  key_links:
    - from: "resources/js/Pages/Subscriptions/Index.tsx"
      to: "/api/v1/subscriptions"
      via: "useApi hook fetching subscription list"
      pattern: "api/v1/subscriptions"
    - from: "resources/js/Pages/Savings/Index.tsx"
      to: "/api/v1/savings"
      via: "useApi hook fetching recommendations"
      pattern: "api/v1/savings"
    - from: "resources/js/Pages/Tax/Index.tsx"
      to: "/api/v1/tax/summary"
      via: "useApi hook fetching tax summary"
      pattern: "api/v1/tax"
    - from: "resources/js/Components/SpendWise/ExportModal.tsx"
      to: "/api/v1/tax/export"
      via: "axios POST to trigger export generation"
      pattern: "api/v1/tax/export"
---

<objective>
Build the remaining 3 frontend pages (Subscriptions, Savings, Tax) and 4 shared components (SubscriptionCard, RecommendationCard, ExportModal, ViewModeToggle). Complete the full frontend application.

Purpose: Finish all user-facing pages so the application has a complete UI for every feature built in Phases 1-3. After this plan, users can interact with every backend feature through the React frontend.

Output: 3 pages, 4 shared components. Full frontend complete (8 pages total, 12+ shared components).
</objective>

<execution_context>
@/home/jratz/.claude/get-shit-done/workflows/execute-plan.md
@/home/jratz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-events-notifications-frontend/04-RESEARCH.md
@.planning/phases/04-events-notifications-frontend/04-02-SUMMARY.md
@existing-code/reference-dashboard.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build SubscriptionCard, RecommendationCard, ExportModal, ViewModeToggle components</name>
  <files>
    resources/js/Components/SpendWise/SubscriptionCard.tsx
    resources/js/Components/SpendWise/RecommendationCard.tsx
    resources/js/Components/SpendWise/ExportModal.tsx
    resources/js/Components/SpendWise/ViewModeToggle.tsx
  </files>
  <action>
    Create 4 shared components. All use dark theme (bg-sw-card, text-sw-text, border-sw-border), Lucide icons, and TypeScript types from spendwise.d.ts.

    1. **SubscriptionCard** (`resources/js/Components/SpendWise/SubscriptionCard.tsx`):
       - Props: `{ subscription: Subscription; onCancel?: (id: number) => void }`
       - Card layout (bg-sw-card, rounded-lg, border border-sw-border, p-4)
       - Top: merchant name (text-lg font-semibold), status badge (Badge component — active=success, inactive=neutral, cancelled=danger, paused=warning)
       - Middle: amount per frequency (e.g., "$9.99/month"), annual cost below
       - Bottom: category badge, last charge date, next expected date
       - If status is 'unused' or inactive: yellow warning border (border-sw-warning) and "Unused" badge
       - Optional cancel/review button at bottom

    2. **RecommendationCard** (`resources/js/Components/SpendWise/RecommendationCard.tsx`):
       - Props: `{ recommendation: SavingsRecommendation; onDismiss: (id: number) => void; onApply: (id: number) => void }`
       - Card with priority indicator (high=red left border, medium=yellow, low=green)
       - Title, description, potential savings amount (prominent, text-sw-accent)
       - Category badge
       - Expandable action steps list (if action_steps is not null) — chevron toggle to show/hide
       - Related merchants list (if present) — small text below
       - Bottom: "Dismiss" button (text-sw-dim hover:text-sw-danger) and "Apply" button (bg-sw-accent hover:bg-sw-accent-hover text-white)
       - Applied state: grayed out with checkmark

    3. **ExportModal** (`resources/js/Components/SpendWise/ExportModal.tsx`):
       - Props: `{ open: boolean; onClose: () => void; year: number; mode: 'download' | 'email'; onExport?: () => void }`
       - Uses @headlessui/react Dialog
       - If mode is 'download':
         - Title: "Export Tax Package"
         - Format selection: checkboxes for Excel, PDF, CSV (all checked by default)
         - "Generate Export" button — POST to `/api/v1/tax/export` with `{ year, formats: [...] }`
         - After generation, show download link (GET `/api/v1/tax/export/download?year=YYYY`)
         - Loading state during generation
       - If mode is 'email':
         - Title: "Send to Accountant"
         - Email input field (pre-filled if available)
         - Message textarea (optional)
         - Format selection (same as above)
         - "Send" button — POST to `/api/v1/tax/send-to-accountant` with `{ year, email, message, formats }`
         - Success confirmation after send
       - Dark themed (bg-sw-card modal, bg-sw-bg/80 backdrop)

    4. **ViewModeToggle** (`resources/js/Components/SpendWise/ViewModeToggle.tsx`):
       - Props: `{ value: 'all' | 'personal' | 'business'; onChange: (mode: 'all' | 'personal' | 'business') => void }`
       - Three-button segmented control
       - Active button: bg-sw-accent text-white
       - Inactive buttons: bg-sw-card text-sw-muted hover:text-sw-text
       - Icons: Globe (all), User (personal), Briefcase (business) from Lucide
       - Compact horizontal layout
  </action>
  <verify>
    Run `npm run build` to verify TypeScript compilation.
    Verify all 4 files exist: `ls resources/js/Components/SpendWise/SubscriptionCard.tsx resources/js/Components/SpendWise/RecommendationCard.tsx resources/js/Components/SpendWise/ExportModal.tsx resources/js/Components/SpendWise/ViewModeToggle.tsx`
  </verify>
  <done>
    4 shared components created with dark theme, TypeScript props, Lucide icons. SubscriptionCard shows subscription details with status badges. RecommendationCard shows savings recommendations with dismiss/apply. ExportModal handles both download and email export flows. ViewModeToggle provides all/personal/business switching.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build Subscriptions, Savings, and Tax pages</name>
  <files>
    resources/js/Pages/Subscriptions/Index.tsx
    resources/js/Pages/Savings/Index.tsx
    resources/js/Pages/Tax/Index.tsx
  </files>
  <action>
    Build the final 3 pages. All use AuthenticatedLayout, useApi hook, dark theme, Head for title.

    1. **Subscriptions** (`resources/js/Pages/Subscriptions/Index.tsx`):
       - Fetches from `/api/v1/subscriptions` using useApi
       - Top summary row: 3 StatCards — Total Monthly Cost, Total Annual Cost, Unused Subscriptions Count
       - Calculate totals from subscription data: sum active subscription amounts for monthly, multiply by 12 for annual (or use annual_cost property), count where status is inactive/unused
       - ViewModeToggle (all/personal/business) — not all subscriptions have account_purpose, so this may filter if available
       - Main content: grid of SubscriptionCard components (grid-cols-1 md:grid-cols-2 lg:grid-cols-3, gap-4)
       - Unused subscriptions highlighted at top with warning banner: "You have {N} potentially unused subscriptions costing ${X}/month"
       - "Detect Subscriptions" button — POST to `/api/v1/subscriptions/detect`, shows loading spinner, refreshes list after
       - Empty state: "No subscriptions detected yet. Connect your bank and we'll find them automatically."
       - Loading skeleton: 6 placeholder cards

    2. **Savings** (`resources/js/Pages/Savings/Index.tsx`):
       - Multiple data fetches:
         - `/api/v1/savings/recommendations` for recommendation list
         - `/api/v1/savings/target` for savings target
       - Section 1: Savings Target (if set)
         - Progress gauge: circular or horizontal progress bar showing current_amount / target_amount
         - Target name, deadline, monthly target amount
         - "Edit Target" button
         - If no target: "Set a Savings Target" form — inputs for name, target_amount, deadline — POST to `/api/v1/savings/target`
       - Section 2: Recommendations
         - Grid of RecommendationCard components (grid-cols-1 lg:grid-cols-2, gap-4)
         - Dismiss: POST to `/api/v1/savings/recommendations/{id}/dismiss`, remove from list
         - Apply: POST to `/api/v1/savings/recommendations/{id}/apply`, update card state
         - "Analyze Spending" button — POST to `/api/v1/savings/analyze`, loading state, refresh after
       - Section 3: Pulse Check
         - "How am I doing?" button — GET `/api/v1/savings/pulse-check`
         - Shows result summary in a card when available
       - Empty state: "Run a savings analysis to get personalized recommendations."

    3. **Tax** (`resources/js/Pages/Tax/Index.tsx`):
       - Year selector dropdown at top (default: current year, options: current year and prior year)
       - Fetches from `/api/v1/tax/summary?year=YYYY` using useApi (re-fetches when year changes)
       - Top summary row: 3 StatCards — Total Business Expenses, Total Tax Deductible, Total Personal Expenses
       - Main section: Deductions by Schedule C Line
         - Table or card list showing each deduction category with: category name, IRS tax line, total amount, transaction count
         - Sorted by total amount descending
         - Each row clickable to see transactions for that category (could link to Transactions page with filter)
       - Chart section: Bar chart (Recharts BarChart) showing business vs personal expenses by category (top 10 categories)
       - Export section: Two buttons
         - "Export Tax Package" — opens ExportModal in download mode
         - "Send to Accountant" — opens ExportModal in email mode
       - Export handles the full flow: generate via API, download result
       - Empty state: "No tax data available for {year}. Connect your bank to start tracking deductible expenses."

    **Patterns for all 3 pages:**
    - Wrap in `<AuthenticatedLayout>` with `<Head title="Page Name" />`
    - Loading skeleton while data is fetching
    - Error handling with retry capability
    - Monetary formatting: `new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount)`
    - Responsive grid layouts
    - Action buttons dispatch axios requests and then call `refresh()` from useApi to update data
  </action>
  <verify>
    Run `npm run build` to verify all TypeScript compiles without errors.
    Verify pages exist: `ls resources/js/Pages/Subscriptions/Index.tsx resources/js/Pages/Savings/Index.tsx resources/js/Pages/Tax/Index.tsx`
    Verify total page count: `ls resources/js/Pages/Dashboard.tsx resources/js/Pages/Transactions/Index.tsx resources/js/Pages/Subscriptions/Index.tsx resources/js/Pages/Savings/Index.tsx resources/js/Pages/Tax/Index.tsx resources/js/Pages/Connect/Index.tsx resources/js/Pages/Settings/Index.tsx resources/js/Pages/Questions/Index.tsx` (should show 8 files)
    Verify total SpendWise component count: `ls resources/js/Components/SpendWise/` (should show 12+ files)
  </verify>
  <done>
    Subscriptions page shows subscription card grid with cost totals and unused warnings. Savings page shows target progress, recommendation cards with dismiss/apply, analysis trigger, and pulse check. Tax page shows year-selectable summary, deduction table, expense chart, export and send-to-accountant modals. All 8 frontend pages complete. 12+ shared components created. Full frontend application built matching reference dashboard design.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with no TypeScript errors
2. All 8 pages exist and have valid TypeScript
3. All 12+ SpendWise components exist in `resources/js/Components/SpendWise/`
4. Subscriptions page fetches from `/api/v1/subscriptions` and renders SubscriptionCards
5. Savings page fetches recommendations and target, supports dismiss/apply
6. Tax page fetches summary by year, shows deductions table, has export modal
7. ExportModal handles both download and email flows
8. ViewModeToggle switches between all/personal/business
</verification>

<success_criteria>
- Subscriptions, Savings, Tax pages all render with real API data
- SubscriptionCard, RecommendationCard, ExportModal, ViewModeToggle components all functional
- All 8 frontend pages complete (Dashboard, Transactions, Subscriptions, Savings, Tax, Connect, Settings, Questions)
- All 12+ shared SpendWise components created
- `npm run build` succeeds
- Frontend matches reference dashboard design (dark theme, card layout, chart styles)
</success_criteria>

<output>
After completion, create `.planning/phases/04-events-notifications-frontend/04-03-SUMMARY.md`
</output>
